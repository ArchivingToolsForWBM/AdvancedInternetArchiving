<html>
	<head>
		<style>
			html {
			background-color: black;
			color: white;
			font-family: sans-serif;
			}
			
			table, th, td {
			border: 1px solid white;
			border-collapse: collapse;
			}
			
			span.NoLineBreak {
				white-space: nowrap;
			}
			input[type='text'] { font-family: monospace;}
			input[type='number'] { font-family: monospace;}
			
			td label {   /* thanks to Patrick McElhaney - https://stackoverflow.com/questions/9739259/tick-a-checkbox-in-a-table-cell-by-clicking-anywhere-in-the-table-cell , causes table cells with labels inside them to focus onto whats inside a label */
				display: block;
				text-align: center;
			}
			
		</style>
	</head>
<body>
<h1 style="text-align: center;">General URL converter</h1>
<p>This is a general tool to convert multiple different types of URLs.</p>
<p>To edit or add converters, open this HTML file using a text editor (such as notepad++), and see <kbd>ListOfConverters</kbd></p>

<p>Enter text that have URLs in them here</p>
<label><input type="checkbox" id="AutoUpdate" onchange="Auto_update()" checked>Auto update</label><br>
<textarea style="white-space: pre; overflow-wrap: normal; overflow-x: scroll;" id="Input_EnteredURLs" cols="100" rows="30" oninput="Auto_update()"></textarea><br>
Sort:
<ul>
	<li><label><input type="radio" name="SortSetting" onchange="Auto_update()" id="SortSetting_None">None (be in the same order as the input)</label></li>
	<li><label><input type="radio" name="SortSetting" checked onchange="Auto_update()" id="SortSetting_ABC">Alphabetically</label> (<label><input type="radio" name="SortSetting" onchange="Auto_update()" id="SortSetting_ABC_Reverse">Reverse</label>)</li>
</ul>
<hr>
<textarea style="white-space: pre; overflow-wrap: normal; overflow-x: scroll; background-color : #000000; color : #ffffff;" id="HTML_OutputString" cols="100" rows="30" readonly></textarea><br>
<button onclick="setClipboard(document.getElementById('HTML_OutputString').value)" id="Button_CopyOutput">Copy to clipboard</button><span id="CopiedTextMessage"></span><br><br>
<script>
	//An array containing a list of objects specifying the replacement.
	//FindWhat: <Regex>: A regular expression the URLs in the input must match with to identify what appropriate replacement to perform a URL conversion
	// NOTE: I recommend matching the entire string if you do not fully understand how the URL format of a given website work.
	//ReplaceWith: An array containing 1 or more items to replace with
	//IncludeOriginal: <Boolean>: False if you only wanted the converted URL to be included in the output, true if you want to include
		const ListOfConverters = [
			{
				//Example 1: Twitter image URLs
				FindWhat:/https:\/\/pbs\.twimg\.com\/media\/([^\s\?]+\?format=[a-zA-Z0-9]+).*$/, //If this doesn't match the entire string, the substring that is not matched will be included, making the URL invalid
				ReplaceWith:["https://pbs.twimg.com/media/$1&name=orig", "https://pbs.twimg.com/media/$1&name=thumb"],
				IncludeOriginal:false
			}
		]
	function Auto_update() {
		if (document.getElementById("AutoUpdate").checked) {
			MainFunction()
		}
	}
	//Copy text from textarea
		function setClipboard(String) {
			//Credit goes to Mozilla: https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/write
			const type = "text/plain";
			const blob = new Blob([String], { type });
			const data = [new ClipboardItem({ [type]: blob })];
	
			navigator.clipboard.write(data).then(
				() => {
				/* success */
					document.getElementById("CopiedTextMessage").innerHTML = " <span style='color: #00FF00;'>Copied!</span>"
					setTimeout(DeleteCopyMessage, 1500)
				},
				() => {
				/* failure */
					document.getElementById("CopiedTextMessage").innerHTML = " <span style='color: #FF0000;'>Copy failed!</span>"
					setTimeout(DeleteCopyMessage, 1500)
				}
			);
		}
		function DeleteCopyMessage() {
			document.getElementById("CopiedTextMessage").innerHTML = ""
		}
	
	function MainFunction() {
		let ListOfURLs = document.getElementById("Input_EnteredURLs").value.match(/ttp(s)?\:\/\/(?!data:)[^\s\"\']+/g) //Why ttps instead of https? Blame firefox's URL truncation of long URLs.
		if (ListOfURLs == null) {
			ListOfURLs = [] //failsafe, prevents Array.map from performing a null which on the browser, would do nothing (if user enters a string with no valid URL).
		}
		ListOfURLs = ListOfURLs.map(ArrayElement => {
			return ArrayElement.replace(/^ttp(s)?/, "http$1").replace(/#.*$/, "") //Revert the URL to have the "h" of the http/https, and remove fragment identifier
		});
		
		let OutputSet = new Set()
		ListOfURLs.forEach(ArrayElement_EnteredURL => {
			ListOfConverters.forEach(ArrayElement_Converter => {
				if (ArrayElement_Converter.IncludeOriginal) {
					OutputSet.add(ArrayElement_EnteredURL)
				}
				if (ArrayElement_Converter.FindWhat.test(ArrayElement_EnteredURL)) {
					ArrayElement_Converter.ReplaceWith.forEach(ArrayElement_ReplaceWith => {
						OutputSet.add(ArrayElement_EnteredURL.replace(ArrayElement_Converter.FindWhat, ArrayElement_ReplaceWith))
					});
					
				};
			});
		});
		
		let OutputArray = Array.from(OutputSet)
		if (document.getElementById("SortSetting_ABC").checked) {
			OutputArray.sort()
		} else if (document.getElementById("SortSetting_ABC_Reverse").checked) {
			OutputArray.sort((a, b) => {
				if (a === b) {
					return 0;
				} else {
					return (a < b) ? 1 : -1;
				}
			});
		}
		let OutputString = ""
		
		OutputArray.forEach((ArrayElement, ArrayIndex, ArrayItself) => {
			OutputString += ArrayElement
			if (ArrayIndex != ArrayItself.length - 1) {
				OutputString += "\n"
			}
		});
		document.getElementById("HTML_OutputString").value = OutputString
	}
</script>